@page "/propostas"
@using RealtyHub.Core.Models
@inherits ListOffersPage

<MudText Typo="Typo.h3">Propostas</MudText>

<PageTitle>Propostas</PageTitle>

<MudDataGrid T="Offer"
             Class="mt-4"
             ServerData="LoadServerData"
             @ref="DataGrid"
             RowsPerPage="@Core.Configuration.DefaultPageSize"
             RowClick="@(e => SelectOffer(e.Item))"
             RowStyle="cursor: pointer">

    <ToolBarContent>
        <MudText Typo="Typo.h6">Propostas</MudText>
        <MudSpacer />
        <MudDateRangePicker PickerVariant="PickerVariant.Dialog"
                            Label="Escolha a data da proposta"
                            DateRange="DateRange"
                            DateRangeChanged="OnDateRangeChanged"
                            Clearable="true" />
    </ToolBarContent>
    <Columns>
        <PropertyColumn Property="v=>v.SubmissionDate" Title="Data"></PropertyColumn>
        <PropertyColumn Property="v=>v.Customer!.Name" Title="Cliente"></PropertyColumn>
        <PropertyColumn Property="v=>v.Property!.Title" Title="Imóvel"></PropertyColumn>
        <TemplateColumn Title="Valor">
            <CellTemplate>
                @context.Item.Amount.ToString("C")
            </CellTemplate>
        </TemplateColumn>
        <TemplateColumn Title="Status">
            <CellTemplate>
                <OfferStatus Status="@context.Item.OfferStatus" />
            </CellTemplate>
        </TemplateColumn>
        <TemplateColumn Class="justify-end" Title="Ações">
            <CellTemplate>
                <MudTooltip Text="Aceitar">
                    <MudIconButton Icon="@Icons.Material.Filled.Done"
                                   Color="Color.Primary"
                                   OnClick="() => OnAcceptClickedAsync(context.Item)"
                                   Disabled="@(context.Item.OfferStatus != EOfferStatus.Analysis)" />
                </MudTooltip>
                <MudTooltip Text="Rejeitar">
                    <MudIconButton Icon="@Icons.Material.Filled.Cancel"
                                   Color="Color.Primary"
                                   OnClick="() => OnRejectClickedAsync(context.Item)"
                                   Disabled="@(context.Item.OfferStatus != EOfferStatus.Analysis)" />
                </MudTooltip>
                @if (context.Item.OfferStatus == EOfferStatus.Accepted && context.Item.Contract is null)
                {
                    <MudTooltip Text="Emitir contrato">
                        <MudIconButton Icon="fa-solid fa-file-contract"
                                       Color="Color.Primary"
                                       OnClick="() => OnIssueContractClickedAsync(context.Item)" />
                    </MudTooltip>
                }
                @if (context.Item.Contract is not null)
                {
                    <MudTooltip Text="Baixar contrato">
                        <MudIconButton Icon="@Icons.Material.Filled.Download"
                                       Color="Color.Primary"
                                       OnClick="() => DownloadContract()" />
                    </MudTooltip>
                }
            </CellTemplate>
        </TemplateColumn>
    </Columns>
    <PagerContent>
        <MudDataGridPager T="Offer" />
    </PagerContent>
</MudDataGrid>

<style>
    .detalhes-cell {
        white-space: normal;
        word-wrap: break-word;
        max-width: 200px;
    }
</style>